# 概要

本项目基于Zynq 7000开发, 使用外设包括`1024*600`VGA接口的TFT显示屏进行图像显示, 音频芯片`ADAU1761`进行音频输出. 最终设计实现通过SD卡读取音频文件进行音乐播放, 同时通过显示屏实时显示时域波形, FFT频域波形与MRA波形. 所用的开发板的具体型号为来自**E-ELEMENT**的**EDK_Z7_TCC**

# 外部资源使用

### 硬件外设

* ADAU1761 音频芯片
* SD卡读取控制器
* VGA接口`1024*600`TFT显示屏

### Xilinx IP核使用

* ZYNQ Process System
* VDMA
* VTC
* AXI4-Stream to Video Out
* Audio Formatter
* I2S Transmitter
* AXI Interconnect, Utility Vector Logic ...

### ZYNQ PS资源使用

* GPIO, 基于EMIO, 主要用于读取按键与拨码开关
* UART控制器
* IIC控制器
* AXI HP接口, 用于PL与DDR3通信
* SD控制器
* QSPI, 用于读写Flash

### 软件库的使用

* 由vivado自动生成的各种资源的驱动库
* xilffs库

# 软件程序设计

### GUI显示布局

整个屏幕的大小为`1024*600`, 实时波形采样长度定为1024, 波形最大归一化峰峰值定为200. 线宽为1个像素.

归一化: 音频信号为20bit的有符号数, 首先将源数据右移为16bit并以`u16`读取, 随后转换为有符号数. 将16bit归一化至`-100~100`内, 绘制波形.

帧切换: 在事件主循环内监视音乐播放进度, 并实时跟进播放进度.

### 音频波形显示

为了显示波形我维护了一个循环队列, 他在每一个`PERIOD`里进行数据更新, 推入新数据, 推出旧数据. 队列总共能储存4个`PERIOD`的数据, 波形的绘制完全以队列中储存的数据为基准.

### 控制功能

* 读取多个音乐
* 切歌
* 音量调节
* 快进
* 

# FPGA硬件IP核设计

### 编程相关引脚分配

* 对于EMIO_GPIO各个引脚功能的映射记录:

* | 0    | S0     |
  | ---- | ------ |
  | 1    | S1     |
  | 2    | S2     |
  | 3    | S3     |
  | 4    | S4     |
  | 5    | SW0    |
  | 6    | SW1    |
  | 7    | SW2    |
  | 8    | LED0_B |
  | 9    | LED1_B |


### 音量控制

通过设置芯片内寄存器`LHPVOL`与`RHPVOL`可以设置左声道与右声道HeadPhone输出的音量, 具体调整范围为`0~63`, 我以4为步进单位进行音量控制与显示.

